@startuml
Class SpaceController {
    - SpaceService spaceService
    + void CreateSpace(req)
    + void UpdateSpace(req)
    + void GetSpaceById(req)
    + void GetAllSpaces(req)
    + void DeleteSpace(req)
}

Class SpaceService {
    - UsersService usersService
    - SpaceRepository spaceRepository
    + Space GetSpaceById(spaceId)
    + int64 ComputeBookingPrice(spaceId, Duration)
    + Space CreateSpace(username, password, location, substation, price, capacity, img)
    + Space[] GetAllSpaces()
    + int DeleteSpace(spaceId, username, password)
    + Space UpdateSpace(spaceId, username, password, location, substation, price, capacity, img)
}

Class UsersController {
    - UsersService usersService
    + void CreateUser(req)
    + void UserLogin(req)
    + void GetUserById(req)
    + void GetAllUsers(req)
}

Class UsersService {
    - UsersRepository usersRepository
    + int GetUserId(username)
    + User GetUserById(userId)
    + int AuthenticateUser(username, password)
    + bool UserIsAdmin(username)
    + User Login(username, password)
    + User CreateUser(username, password)
    + User[] GetAllUsers()
}

Class UsersRepository {
    + int Insert(user)
    + User GetUserById(id)
    + User GetUserByName(username)
    + User[] GetAllUsers()
}

Class SpaceRepository {
    - Database db
    + Space GetSpace(location, substation)
    + Space GetSpaceById(id)
    + int Insert(space)
    + error Update(space)
    + Space[] GetAllSpaces()
    + error DeleteSpace(id)
}

Class Space {
    + int Id
    + string Location
    + string Substation
    + double Price
    + int Capacity
    + byte[] Img
}

Class User {
    + int Id
    + string Username
    + string PassHash
    + bool IsAdmin
}

Class BookingController {
    - BookingService bookingService
    + void BookSpace(req)
    + void GetBookingById(req)
    + void GetAllBookings(req)
    + void GetUserBookings(req)
    + void CancelBooking(req)
}

Class BookingService {
    - BookingRepository bookingRepository
    - UsersService usersService
    - SpaceService spaceService
    - PaymentsService paymentsService
    + int BookSpace(username, password, spaceId, startDate, days)
    + BookingParsed[] GetAllBookings()
    + BookingParsed GetBookingById(bookingId)
    + bool IsBookingOwner(userId, bookingId)
    + int CancelBookingById(username, password, bookingId)
    + BookingParsed[] GetUserBookings(userId)
}

Class BookingRepository {
    - Database db
    + bool CheckBookingConflicts(booking)
    + int Insert(booking)
    + Booking GetBookingById(id)
    + Booking[] GetAllBookings()
    + int Delete(id)
    + Booking[] GetUserBookings(userId)
}

Class Booking {
    + int Id 
    + int UserId 
    + int SpaceId 
    + int64 Start
    + int64 End
    + Validate()
}

Class BookingParsed {
    + int Id
    + int UserId
    + int SpaceId
    + string StartDate
    + string EndDate
    + int Days
}

Class PaymentsController {
    - PaymentsService paymentsService
    + MakePayment(req)
    + GetPaymentsById(req)
}

Class PaymentsService {
    - PaymentsRepository paymentsRepository
    + int CreatePayment(id, value)
    + Payment GetPaymentById(paymentId)
    + int MakePayments(paymentId, value)
}

Class PaymentsRepository {
    - Database db
    + bool SavePayments(pix)
    + Payments GetPaymentsById(pixId)
}

Class Payment {
    + int Id
    + int64 TotalValue
    + int64 PayedValue
}


SpaceController --> SpaceService : "Chama métodos"
SpaceService -d-> Space : "Cria / usa"
SpaceService -l-> SpaceRepository : "Chama métodos"
SpaceService --> UsersService : "Chama métodos"

UsersService --> UsersRepository : "Chama métodos"
UsersService --> User : "Cria / usa"

SpaceRepository -d-> Space : "Retorna"
UsersRepository --> User : "Retorna"

PaymentsController --> PaymentsService : "Chama métodos"
PaymentsService -r-> PaymentsRepository : "Chama métodos"
PaymentsRepository --> Payment : "Retorna"
PaymentsService --> Payment : "Cria / usa"

BookingController --> BookingService : "Chama métodos"
BookingService --> BookingRepository : "Chama métodos"
BookingService -l-> SpaceService : "Chama métodos"
BookingService -d-> UsersService : "Chama métodos"
BookingService -r-> PaymentsService : "Chama métodos"
BookingService --> Booking : "Cria / usa"
BookingService --> BookingParsed : "Cria / retorna"
BookingRepository --> Booking : "Retorna"

SpaceController -r[hidden]-> BookingController
BookingController -l[hidden]-> SpaceController
BookingController -r[hidden]-> PaymentsController
PaymentsController -l[hidden]-> BookingController
UsersController --> UsersService : "Chama Métodos"

@enduml